<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Portal NFe - Baixar Todos XMLs</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;max-width:720px;margin:40px auto;padding:0 20px}
    button{padding:10px 16px;font-size:15px;margin-top:12px}
    .log{background:#f6f6f6;border-left:4px solid #ccc;padding:10px;margin-top:12px;white-space:pre-wrap}
  </style>
</head>
<body>
  <h2>Portal NFe — Baixar Todos XMLs</h2>
  <p>Modo do servidor: <strong id="mode">—</strong></p>

  <button id="btnDownload">Baixar Todos XMLs</button>
  <div id="log" class="log"></div>

<script>
async function loadMode() {
  const r = await fetch('/api/ping');
  const j = await r.json();
  document.getElementById('mode').innerText = j.mode || 'MOCK';
}
loadMode();

document.getElementById('btnDownload').addEventListener('click', async () => {
  const log = document.getElementById('log');
  log.innerText = 'Iniciando download...';

  try {
    const resp = await fetch('/api/download-all');
    const j = await resp.json();
    log.innerText = JSON.stringify(j, null, 2) + '\nVerifique a pasta downloads/ no servidor.';
  } catch(e){
    log.innerText = 'Falha: ' + e.message;
  }
});
</script>
</body>
</html>
